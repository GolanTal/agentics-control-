name: agentics-scheduler
on:
  schedule:
    - cron: "0 13 * * 1"    # Mon plan (UTC)
    - cron: "0 14 * * 1-5"  # Weekdays content
    - cron: "0 21 * * 5"    # Fri report
  workflow_dispatch:

jobs:
  daily_content:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }
      - run: python -m pip install --upgrade pip && pip install -r requirements.txt
      - name: Run pipeline (mine → normalize → schedule)
        env:
          APPS_URL:   ${{ secrets.APPS_URL }}
          APPS_TOKEN: ${{ secrets.APPS_TOKEN }}
          SOURCE_TEXT_URL: ${{ secrets.SOURCE_TEXT_URL }}   # optional
        run: bash scripts/run_pipeline.sh

  weekly_report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }
      - run: python -m pip install --upgrade pip && pip install -r requirements.txt
      - name: Build analytics one-pager
        env:
          APPS_URL:   ${{ secrets.APPS_URL }}
          APPS_TOKEN: ${{ secrets.APPS_TOKEN }}
        run: python agents/analyst.py
